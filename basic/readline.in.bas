REM READLINE(A$) -> R$
READLINE:
  EOF=0
  PROMPT$=A$
  PRINT PROMPT$;
  CH$="": LI$="": CH=0
  READCH:
    GET CH$: IF CH$="" THEN READCH
    CH=ASC(CH$)
    REM PRINT CH
    IF (CH=4 OR CH=0) THEN EOF=1: GOTO RL_DONE: REM EOF
    IF (CH=127) OR (CH=20) THEN GOSUB RL_BACKSPACE
    IF (CH=127) OR (CH=20) THEN GOTO READCH
    IF (CH<32 OR CH>127) AND CH<>13 THEN READCH
    PRINT CH$;
    IF LEN(LI$)<255 AND CH$<>CHR$(13) THEN LI$=LI$+CH$
    IF LEN(LI$)<255 AND CH$<>CHR$(13) THEN GOTO READCH
  RL_DONE:
    R$=LI$
    RETURN

  REM Assumes LI$ has input buffer
  RL_BACKSPACE:
    IF LEN(LI$)=0 THEN RETURN
    LI$=LEFT$(LI$, LEN(LI$)-1)
    PRINT CHR$(157)+" "+CHR$(157);
    RETURN 
