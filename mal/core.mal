(def! _macro_magic
  :_I_tell_ya_this_is_a_MAL_macro_mark_my_words)

(def! _macro_wrap (fn* [f]
  [_macro_magic f]))

(def! _macro_unwrap (fn* [x]
  (if (vector? x)
    (if (= (first x) _macro_magic)
      (nth x 1)))))

(def! _macro? (fn* [x]
  (if (_macro_unwrap x)
    true
    false)))

(def! false_on_macro (fn* [f]
  (fn* [x]
    (if (_macro_unwrap x)
      false
      (f x)))))
(def! _sequential? (false_on_macro sequential?))
(def! _vector? (false_on_macro vector?))

(def! core_ns
  [['= =]
   ['throw throw]
   ['nil? nil?]
   ['true? true?]
   ['false? false?]
   ['number? number?]
   ['string? string?]
   ['symbol symbol]
   ['symbol? symbol?]
   ['keyword keyword]
   ['keyword? keyword?]
   ['fn? fn?]
   ['macro? _macro?]

   ['pr-str pr-str]
   ['str str]
   ['prn prn]
   ['println println]
   ['readline readline]
   ['read-string read-string]
   ['slurp slurp]
   ['< <]
   ['<= <=]
   ['> >]
   ['>= >=]
   ['+ +]
   ['- -]
   ['* *]
   ['/ /]
   ['time-ms time-ms]

   ['list list]
   ['list? list?]
   ['vector vector]
   ['vector? _vector?]
   ['hash-map hash-map]
   ['map? map?]
   ['assoc assoc]
   ['dissoc dissoc]
   ['get get]
   ['contains? contains?]
   ['keys keys]
   ['vals vals]

   ['sequential? _sequential?]
   ['cons cons]
   ['concat concat]
   ['nth nth]
   ['first first]
   ['rest rest]
   ['empty? empty?]
   ['count count]
   ['apply apply]
   ['map map]

   ['conj conj]
   ['seq seq]

   ['with-meta with-meta]
   ['meta meta]
   ['atom atom]
   ['atom? atom?]
   ['deref deref]
   ['reset! reset!]
   ['swap! swap!]])
